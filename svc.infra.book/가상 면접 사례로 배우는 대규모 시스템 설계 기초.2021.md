## 1장 사용자 수에 따른 규모 확장성
* 단일 서버
* 데이터베이스
* 수직적 규모 확장 vs 수평적 규모 확장
	* 로드밸런서
	* 데이터베이스 다중화
* 캐시
* 콘텐츠 전송 네트워크(CDN)
* 무상태(stateless) 웹계층
	* 상태 정보 의존적 아키텍처
	* 무상태 아키텍처
* 데이터 센터
* 메시지 큐
* 로그, 메트릭, 자동화
* 데이터베이스의 규모 확장
* 백만 사용자, 그 이상
	* 웹 계층은 무상태, 모든 계층에 다중화 도입, 가능한 많은 데이터를 캐시, 여러 데이터 센터 지원, 정적 콘텐츠는 CDN, 데이터 계층은 샤딩을 통해 규모 확장, 각 계층은 독립적 서비스, 시스템을 지속 모니터링하고 자동화 도구 활용


## 2장 개략적인 규모 추정
* 2의 제곱수
* 응답지연 값
	* 메모리는 빠르고 디스크는 느림, 디스크 탐색은 가능한 회피, 단순한 압축 알고리즘 빠름, 데이터를 
* 가용성 수치들
	* 99.99%: 일당 8.64초
* 예제: 트위터 QPS와 저장소 요구량 추정


## 3장 시스템 설계 면접 공략법
	* 뉴스 피드: 피드 publishing, 피드 building
* 문제 이해 및 설계 범위 확정
* 개략적 설계안 제시 및 동의 구하기
* 상세 설계


## 4장 처리율 제한장치의 설계
* 문제 이해 및 설계 범위 확정
	* 요구사항: 제한을 설정, 낮은 응답시간, 적은 메모리 사용, 분산형 처리율 제한(여러 서버/프로세스가 공유), 예외 처리 피드백, 높은 결함 감내성
* 개략적 설계안 제시 및 동의 구하기
	* 처리율 제한 장치의 위치
	* 알고리즘: 토큰 버킷, 누출 버킷, 고정 윈도 카운터, 이동 윈도 로그, 이동 윈도 카운터
* 상세 설계
* 마무리


## 5장 안정해시 설계
* 해시 키 재배치(rehash) 문제
* 안정 해시
	* 해시 테이블 크기가 조정될 때 최소한의 키만 재배치하는 해시 기술
	* 해시 공간과 해시 링, 해시 서버, 해시 키, 서버 조회, 서버 추가, 서버 제거
	* 기본 구현법의 두 가지 문제, 가상 노드, 재배치할 키 결정


## 6장 키-값 저장소 설계
* 문제 이해 및 설계 범위 확정
	* 키-값 크기, 큰 데이터 수용, 높은 가용성, 높은 규모 확장성, 데이터 일관성 수준 조정 가능, 응답 지연시간 짧음
* 단일 서버 키-값 저장소
	* 키-값 쌍 전무를 메모리에 해시 테이블로 저장
* 분산 키-값 저장소
	* 분산 해키 테이블: 키-값 쌍을 여러 서버에 분산
	* CAP 정리: CAP를 동시에 만족하는 분산 시스템은 불가능, 셋 중 하나는 반드시 희생
		* 일관성(consistency): 어느 노드에 접속해도 같은 데이터 표시
		* 가용성(availability): 일부 노드에 장애가 발생해도 항상 응답 가능
		* 파티션 감내(partition tolerance): 파티션(두 노드 사이에 통신 장애 발생)이 생기더라도 시스템은 계속 동작
	* CP 시스템: 일관성, 파티션 감내를 지원, 가용성 희생
	* AP 시스템: 가용성과 파티션 감내를 지원, 데이터 일관성 희생
	* CA 시스템: 일관성과 가용성 지원, 파티션 감내를 희생
		* 네트워크 장애는 회피 불가하므로 분산시스템은 반드시 파티션 감내 가능해야 하므로
			* 실세계에서 CA 시스템은 존재하지 않음
	* 시스템 컴포넌트: 다이나모, 카산드라, 빅테이블 사례 참고
		* 데이터 파티션
			* 데이터를 여러 서버에 고르게 분산할 수 있는가
			* 노드가 추가되거나 삭제될 때 데이터 이동을 최소화할 수 있는가
			* 안정 해시
				* 규모 확장 자동화
				* 다양성(heterogeneity): 각 서버 용량에 맞게 가상 노드 개수 조정
		* 데이터 다중화(replication)
		* 일관성
			* 정족수 합의(quorum consensus) 프로토콜
			* 일관성 모델: 강한 일관성, 약한 일관성, 최종 일관성
		* 일관성 불일치 해소
			* 데이터 버저닝: 데이터 변경시 새 버전 생성, 각 버전 데이터는 변경 불가(immutable)
		* 장애 처리
			* 장애 처리, 장애 감지, 영구 장애 처리
		* 시스템 아키텍처 다이어그램
			* 클라이언트는 키-값 저장소가 제공하는 get, put api 와 통신
			* 중재자는 proxy 역할을 하는 노드
			* 노드는 안정 해시의 해시 링 위에 분포
			* 노드를 자동으로 추가/삭제할 수 있도록 시스템은 완전 분산
			* 데이터는 여러 노드에 다중화, SPOF(single point of failure)는 존재하지 않음
		* 쓰기 경로(write path)
			* 쓰기 요청이 커밋 로그에 기록
			* 데이터가 메모리 캐시에 기록
			* 메모리 캐시가 가득차거나 임계치에 도달하면 데이터를 디스크의 SSTable(sorted-string table) 에 기록
		* 읽기 경로(read path)
			* 데이터가 메모리에 있는지 검사
			* 없으면 블룸 필터를 검사하여 어떤 SSTable에 키가 보관되어 있는지 확인하여 데이터를 가져온 후 클라이언트에 반환
* 요약
	* 대규모 데이터 저장: 안정 해시를 사용해 서버들에 부하 분산
	* 읽기 연산 가용성: 데이터를 여러 데이터 센터에 다중화
	* 쓰기 연산 가용성: 버저닝 및 벡터 시계를 사용한 충돌 해소
	* 데이터 파티션: 안정 해시
	* 점진적 규모 확장성: 안정 해시
	* 다양성(heterogeneity): 안정 해시
	* 조절 가능한 데이터 일관성: 정족수 합의(quorum consensus)
	* 일시적 장애 처리: 느슨한 정족수 프로토콜(sloppy quorum)과 단서 후 임시 위탁(hinted handoff)
	* 영구적 장애 처리: 머클 트리(merkle tree)
	* 데이터 센터 장애 대응: 여러 데이터 센터에 걸친 데이터 다중화


## 7장 분산시스템을 위한 유일 ID 생성기 설계
* 문제 이해 및 설계 범위 확정
	* RDB auto increment: 여러 DB 서버를 사용해도 지연시간 문제
	* 유일, 숫자, 64비트, 시간 정렬, 초당 10,000개 생성
* 개략적 설계안 제시 및 동의 구하기
	* 다중 마스터 복제(multi-master replication)
		* DB의 auto_increment 기능 활용, 증가 폭이 1이 아니라 DB 서버 수
	* UUID
		* 충돌 가능성이 지극히 낮으므로 서버 간 조욜 없이 생성 가능
		* 단점: 128비트로 길고 시간순 정렬 불가, 숫자 아닌 값 포함됨
	* 티켓 서버
		* auto_increment를 단일 서버에서 발행: 티켓 서버가 SPOF
	* 트위터 스노플레이크 접근법
		* 요구사항 충족
		* 64비트 id 구조: sign 1 bit + 타임스탬프 41 bit + 데이터센터 id 5 bit + 서버 id 5 bit + 일련번호 12 bit
* 상세 설계
	* 기타: 시계 동기화, 길이 최적화, 고가용성


## 8장 URL 단축기 설계
* 문제 이해 및 설계 범위 확정
* 개략적 설계안 제시 및 동의 구하기
	* api 엔드포인트: post 요청
	* URL 리디렉션: get 요청
		* 응답: 301(moved)은 브라우저에서 캐시됨(서버 부하 감소), 302(found)는 분석/추적에 유리
		* 해시 테이블에 단축 url, 오리지널 url 저장
		* 실제 시스템에서는 RDB에 페어를 저장
* 상세 설계
	* 해시 함수 구현
		* 해시 후 충돌 해소: 원본 url 길이를 7글자까지 줄인 후(CRC32, MD5, SHA-1)
			* 길이 고정됨, 유일성 보장 id 생성기 불필요, 충돌 해소 전략 필요, id로 단축 url을 계산하지 않으므로 다음 생성 가능한 url 추정 불가
		* base-62 변환
			* 길이 가변적, 유일성 보장 id 생성기 필요, 충돌 불가, 다음 생성할 단축 url 유추 가능


## 9장 웹크롤러 설계
* 문제 이해 및 설계 범위 확정
* 개략적 설계안 제시 및 동의 구하기
* 상세 설계


## 10장 알림 시스템 설계
* 문제 이해 및 설계 범위 확정
* 개략적 설계안 제시 및 동의 구하기
* 상세 설계


## 11장 뉴스피드 시스템 설계
* 문제 이해 및 설계 범위 확정
* 개략적 설계안 제시 및 동의 구하기
* 상세 설계


## 12장 채팅 시스템 설계
* 문제 이해 및 설계 범위 확정
* 개략적 설계안 제시 및 동의 구하기
* 상세 설계


## 13장 검색어 자동완성 시스템
* 문제 이해 및 설계 범위 확정
* 개략적 설계안 제시 및 동의 구하기
* 상세 설계


## 14장 유튜브 설계
* 문제 이해 및 설계 범위 확정
* 개략적 설계안 제시 및 동의 구하기
* 상세 설계


## 15장 구글드라이브 설계
* 문제 이해 및 설계 범위 확정
* 개략적 설계안 제시 및 동의 구하기
* 상세 설계


## 16장 배움은 계속된다 
* 실세계 시스템들